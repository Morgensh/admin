<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админка Business Empire Richman</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; }
        nav { display: flex; justify-content: space-around; margin-bottom: 20px; }
        nav button { padding: 10px 20px; cursor: pointer; }
        section { display: none; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        section.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        input[type="text"] { padding: 8px; margin-bottom: 10px; width: 200px; }
        button { padding: 6px 12px; cursor: pointer; }
        .delete-btn, .ban-btn { background-color: #ff4d4d; color: white; border: none; }
        #dashboard { text-align: center; font-size: 1.2em; }
    </style>
</head>
<body>
    <nav>
        <button onclick="showSection('dashboard')">Дашборд</button>
        <button onclick="showSection('companies')">Компании</button>
        <button onclick="showSection('users')">Пользователи</button>
    </nav>

    <section id="dashboard" class="active">
        <h2>Дашборд</h2>
        <p>Количество игроков: <span id="players-count">Загрузка...</span></p>
    </section>

    <section id="companies">
        <h2>Компании</h2>
        <input type="text" id="company-search" placeholder="Поиск по имени компании" oninput="loadCompanies()">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Имя</th>
                    <th>Владелец</th>
                    <th>Клиенты</th>
                    <th>Акции</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody id="companies-table"></tbody>
        </table>
    </section>

    <section id="users">
        <h2>Пользователи</h2>
        <input type="text" id="user-search" placeholder="Поиск по username" oninput="loadUsers()">
        <table>
            <thead>
                <tr>
                    <th>Telegram ID</th>
                    <th>Username</th>
                    <th>Имя</th>
                    <th>Баланс</th>
                    <th>Забанен</th>
                    <th>Дата регистрации</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody id="users-table"></tbody>
        </table>
    </section>

    <script>
        const apiBase = 'https://your-server-url.com/api'; // Замени на URL твоего сервера
        const adminId = 6034598170; // Твой Telegram ID

        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            if (sectionId === 'dashboard') loadDashboard();
            if (sectionId === 'companies') loadCompanies();
            if (sectionId === 'users') loadUsers();
        }

        async function fetchWithAdmin(url, options = {}) {
            const fullUrl = `${url}${url.includes('?') ? '&' : '?'}telegram_id=${adminId}`;
            const response = await fetch(fullUrl, options);
            if (!response.ok) throw new Error('Network error');
            return response.json();
        }

        async function loadDashboard() {
            try {
                const data = await fetchWithAdmin(`${apiBase}/admin/players_count`);
                document.getElementById('players-count').textContent = data.count;
            } catch (err) {
                alert('Ошибка загрузки дашборда');
            }
        }

        async function loadCompanies() {
            try {
                const search = document.getElementById('company-search').value;
                const data = await fetchWithAdmin(`${apiBase}/admin/companies?search=${encodeURIComponent(search)}`);
                const tbody = document.getElementById('companies-table');
                tbody.innerHTML = '';
                data.forEach(company => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${company.id}</td>
                        <td>${company.name}</td>
                        <td>${company.owner_username}</td>
                        <td>${company.clients_count}</td>
                        <td>${company.issued_shares}</td>
                        <td><button class="delete-btn" onclick="deleteCompany(${company.id})">Удалить</button></td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (err) {
                alert('Ошибка загрузки компаний');
            }
        }

        async function deleteCompany(id) {
            if (!confirm('Уверен, что хочешь удалить компанию?')) return;
            try {
                await fetchWithAdmin(`${apiBase}/admin/company/${id}`, { method: 'DELETE' });
                loadCompanies();
            } catch (err) {
                alert('Ошибка удаления');
            }
        }

        async function loadUsers() {
            try {
                const search = document.getElementById('user-search').value;
                const data = await fetchWithAdmin(`${apiBase}/admin/users?search=${encodeURIComponent(search)}`);
                const tbody = document.getElementById('users-table');
                tbody.innerHTML = '';
                data.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.telegram_id}</td>
                        <td>${user.username}</td>
                        <td>${user.first_name} ${user.last_name}</td>
                        <td>${user.balance}</td>
                        <td>${user.banned ? 'Да' : 'Нет'}</td>
                        <td>${new Date(user.created_at).toLocaleDateString()}</td>
                        <td><button class="ban-btn" onclick="banUser(${user.telegram_id})" ${user.banned ? 'disabled' : ''}>Забанить</button></td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (err) {
                alert('Ошибка загрузки пользователей');
            }
        }

        async function banUser(telegramId) {
            if (!confirm('Уверен, что хочешь забанить пользователя?')) return;
            try {
                await fetchWithAdmin(`${apiBase}/admin/ban/${telegramId}`, { method: 'POST' });
                loadUsers();
            } catch (err) {
                alert('Ошибка бана');
            }
        }

        // Инициализация
        showSection('dashboard');
    </script>
</body>
</html>
